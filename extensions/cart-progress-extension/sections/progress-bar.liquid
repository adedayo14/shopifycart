{% comment %}
This section displays a free‑shipping progress bar with optional gift and discount tiers.  
The progress bar updates in real time based on the cart total and encourages shoppers to add more items.  
Settings defined below allow merchants to customise thresholds, text, colours and behaviour.
{% endcomment %}

<div id="progress-bar-container"
     data-threshold="{{ section.settings.progress_threshold }}"
     data-gift-threshold="{{ section.settings.gift_threshold }}"
     data-discount-threshold="{{ section.settings.discount_threshold }}"
     data-currency="{{ section.settings.currency_symbol }}"
     data-gift-product-id="{{ section.settings.gift_product_id }}">
  <div class="progress-bar-track" style="background-color: {{ section.settings.bar_color_secondary }}; height: 8px; border-radius: 4px; overflow: hidden;">
    <div class="progress-bar-fill" style="background-color: {{ section.settings.bar_color_primary }}; width: 0%; height: 100%; transition: width 0.4s;"></div>
  </div>
  <p class="progress-bar-message" style="margin-top: 8px;">
    {{ section.settings.bar_text }}
  </p>
</div>

{% schema %}
{
  "name": "Progress Bar",
  "settings": [
    { "type": "number", "id": "progress_threshold", "label": "Free Shipping Threshold", "default": 50 },
    { "type": "number", "id": "gift_threshold", "label": "Free Gift Threshold", "default": 75 },
    { "type": "number", "id": "discount_threshold", "label": "Discount Threshold", "default": 100 },
    { "type": "text", "id": "currency_symbol", "label": "Currency Symbol", "default": "£" },
    { "type": "text", "id": "gift_product_id", "label": "Gift Product ID", "default": "" },
    { "type": "checkbox", "id": "enable_geolocation", "label": "Enable Geolocation", "default": false },
    { "type": "textarea", "id": "country_rules", "label": "Country‑specific Thresholds (JSON)", "default": "" },
    { "type": "checkbox", "id": "enable_multi_currency", "label": "Enable Multi‑currency", "default": false },
    { "type": "text", "id": "market_message", "label": "Market Message", "default": "Free shipping on orders over {threshold}" },
    { "type": "text", "id": "bar_text", "label": "Default Bar Text", "default": "Spend more to get free shipping!" },
    { "type": "select", "id": "bar_style", "label": "Bar Style", "options": [ { "value": "linear", "label": "Linear" }, { "value": "radial", "label": "Circular" } ], "default": "linear" },
    { "type": "color", "id": "bar_color_primary", "label": "Primary Bar Colour", "default": "#e6c173" },
    { "type": "color", "id": "bar_color_secondary", "label": "Secondary Bar Colour", "default": "#ddd" },
    { "type": "select", "id": "bar_position", "label": "Bar Position", "options": [ { "value": "top", "label": "Top of Cart" }, { "value": "bottom", "label": "Bottom of Cart" } ], "default": "top" },
    { "type": "checkbox", "id": "enable_upsell", "label": "Enable Upsell", "default": true },
    { "type": "select", "id": "upsell_algorithm", "label": "Upsell Algorithm", "options": [ { "value": "manual", "label": "Manual" }, { "value": "rule", "label": "Rule‑based" }, { "value": "ai", "label": "AI‑driven" } ], "default": "rule" },
    { "type": "textarea", "id": "upsell_widget_layout", "label": "Upsell Widget Layout (HTML)", "default": "" },
    { "type": "checkbox", "id": "enable_analytics", "label": "Enable Analytics", "default": false },
    { "type": "text", "id": "analytics_dashboard_url", "label": "Analytics Dashboard URL", "default": "" },
    { "type": "checkbox", "id": "enable_ab_testing", "label": "Enable A/B Testing", "default": false },
    { "type": "text", "id": "timer_settings", "label": "Countdown Timer Settings (JSON)", "default": "" },
    { "type": "checkbox", "id": "enable_language_support", "label": "Enable Multi‑language", "default": false },
    { "type": "text", "id": "languages_supported", "label": "Languages Supported (comma‑separated)", "default": "en" },
    { "type": "textarea", "id": "custom_css", "label": "Custom CSS", "default": "" },
    { "type": "checkbox", "id": "enable_gift_wrap", "label": "Enable Gift Wrap Option", "default": false },
    { "type": "checkbox", "id": "gdpr_optin", "label": "Require GDPR Opt‑in for Tracking", "default": false }
  ],
  "blocks": [],
  "presets": [ { "name": "Progress Bar" } ]
}
{% endschema %}

{% javascript %}
(function() {
  // Inject the external JavaScript file for the progress bar behaviour.
  var script = document.createElement('script');
  script.src = '{{ "progress-bar.js" | asset_url }}';
  script.defer = true;
  document.head.appendChild(script);
})();
{% endjavascript %}